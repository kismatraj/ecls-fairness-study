# ECLS Fairness Study Configuration

project:
  name: "ecls-fairness-study"
  version: "0.1.0"

# Paths
paths:
  raw_data: "data/raw/"
  processed_data: "data/processed/"
  results: "results/"
  figures: "results/figures/"
  tables: "results/tables/"
  models: "results/models/"

# Data Configuration
data:
  filename: "childK5p.dat"
  
  # Missing value codes
  missing_codes: [-1, -7, -8, -9]
  suppressed_code: -2
  
  # Sample weights
  weights:
    cross_sectional: "W1C0"
    longitudinal: "W9C29P_20"

# Variables
variables:
  # Outcomes (5th grade)
  outcomes:
    reading: "X9RTHETA"
    math: "X9MTHETA"

  # At-risk threshold
  at_risk_percentile: 25

  # Demographics
  demographics:
    race: "X_RACETH_R"
    sex: "X_CHSEX_R"
    ses: "X1SESQ5"
    language: "X12LANGST"

  # Race labels
  race_labels:
    1: "White"
    2: "Black"
    3: "Hispanic"
    4: "Asian"
    5: "Other"  # NHPI
    6: "Other"  # AIAN
    7: "Other"  # Multiracial

  # Predictors by category
  predictors:
    baseline_cognitive:
      - "X1RTHETK"
      - "X2RTHETK"
      - "X1MTHETK"
      - "X2MTHETK"

    executive_function:
      - "X6DCCSSCR"  # Only X6 available in public-use file

    approaches_to_learning:
      - "X1TCHAPP"
      - "X2TCHAPP"
      - "X4TCHAPP"

    child_demographics:
      - "X_CHSEX_R"
      - "X_RACETH_R"
      - "X1SESQ5"
      - "X12LANGST"

# Model Configuration
model:
  random_state: 42
  test_size: 0.30
  cv_folds: 5

  # Algorithms to train
  algorithms:
    logistic_regression:
      enabled: true
      params:
        C: [0.01, 0.1, 1.0, 10.0]
        penalty: ["l2"]
        max_iter: [1000]

    elastic_net:
      enabled: true
      params:
        alpha: [0.001, 0.01, 0.1, 1.0]
        l1_ratio: [0.2, 0.5, 0.8]

    random_forest:
      enabled: true
      params:
        n_estimators: [100, 200]
        max_depth: [5, 10, 15]
        min_samples_leaf: [5, 10]

    xgboost:
      enabled: true
      params:
        n_estimators: [100, 200]
        max_depth: [3, 5, 7]
        learning_rate: [0.01, 0.1]

    # 2025 State-of-the-Art Models

    lightgbm:
      enabled: true
      params:
        n_estimators: [100, 200]
        max_depth: [5, -1]
        learning_rate: [0.05, 0.1]
        num_leaves: [31]

    catboost:
      enabled: true
      params:
        iterations: [100, 200]
        depth: [4, 6]
        learning_rate: [0.05, 0.1]

    hist_gradient_boosting:
      enabled: true
      params:
        max_iter: [100, 200]
        max_depth: [5, 7]
        learning_rate: [0.05, 0.1]

    tabpfn:
      enabled: false  # Enable for small datasets (<10k samples)
      params: {}

# Fairness Configuration
fairness:
  # Protected attributes
  protected_attributes:
    - "race"
    - "ses"
    - "language"

  # Reference groups
  reference_groups:
    race: "White"
    ses: 5
    language: 1

  # Metrics to compute
  metrics:
    - "demographic_parity"
    - "equalized_odds"
    - "true_positive_rate"
    - "false_positive_rate"
    - "positive_predictive_value"

  # Disparity thresholds
  thresholds:
    disparate_impact: 0.80
    max_tpr_gap: 0.10

  # 2025 State-of-the-Art Settings
  bootstrap_iterations: 200
  confidence_level: 0.95
  min_intersectional_group_size: 20

# Explainability Configuration (2025 State-of-the-Art)
explainability:
  # SHAP settings
  shap:
    enabled: true
    explainer_type: "auto"  # auto, tree, kernel, linear
    max_samples_for_interaction: 500

  # Permutation importance settings
  permutation:
    enabled: true
    n_repeats: 30
    n_bootstrap: 50

  # Partial Dependence Plots
  pdp:
    enabled: true
    top_features: 5

  # Counterfactual explanations
  counterfactuals:
    enabled: false  # Requires dice-ml
    total_cfs: 5

  # Fairness-aware SHAP
  fairness_shap:
    enabled: true

# Temporal Generalization Configuration
temporal:
  enabled: true

  # Demographics always included in every scenario
  demographics:
    - "X_CHSEX_R"
    - "X_RACETH_R"
    - "X1SESQ5"
    - "X12LANGST"

  # Progressive feature-set scenarios
  scenarios:
    - name: "k_only"
      label: "K Fall Only"
      description: "Earliest possible prediction using K Fall data"
      features:
        - "X1RTHETK"
        - "X1MTHETK"
        - "X1TCHAPP"

    - name: "k_complete"
      label: "K Fall + Spring"
      description: "Full kindergarten year data"
      features:
        - "X1RTHETK"
        - "X1MTHETK"
        - "X1TCHAPP"
        - "X2RTHETK"
        - "X2MTHETK"
        - "X2TCHAPP"

    - name: "k_through_1st"
      label: "K + 1st Grade"
      description: "Through 1st grade"
      features:
        - "X1RTHETK"
        - "X1MTHETK"
        - "X1TCHAPP"
        - "X2RTHETK"
        - "X2MTHETK"
        - "X2TCHAPP"
        - "X4TCHAPP"

    - name: "k_through_3rd"
      label: "K through 3rd"
      description: "Full model matching main pipeline"
      features:
        - "X1RTHETK"
        - "X1MTHETK"
        - "X1TCHAPP"
        - "X2RTHETK"
        - "X2MTHETK"
        - "X2TCHAPP"
        - "X4TCHAPP"
        - "X6DCCSSCR"

# Output Configuration
output:
  figure_format: "png"
  figure_dpi: 300
  table_formats: ["csv", "latex"]
